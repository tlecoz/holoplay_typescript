{"version":3,"file":"HoloEppRom.js","sourceRoot":"","sources":["../HoloEppRom.ts"],"names":[],"mappings":"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","sourcesContent":["class HoloEppRom {\r\n\r\n  public jsonObj:any;\r\n  private holoplay:HoloPlay;\r\n  protected defaultCalibration:any = {\"configVersion\":\"1.0\",\"serial\":\"00112\",\"pitch\":{\"value\":49.825218200683597},\"slope\":{\"value\":5.2160325050354},\"center\":{\"value\":-0.23396748304367066},\"viewCone\":{\"value\":40.0},\"invView\":{\"value\":1.0},\"verticalAngle\":{\"value\":0.0},\"DPI\":{\"value\":338.0},\"screenW\":{\"value\":2560.0},\"screenH\":{\"value\":1600.0},\"flipImageX\":{\"value\":0.0},\"flipImageY\":{\"value\":0.0},\"flipSubp\":{\"value\":0.0}};\r\n  public initialized:boolean = false;\r\n  public onReady:Function;\r\n  constructor(holoplay:HoloPlay){\r\n\r\n    this.holoplay = holoplay;\r\n\r\n    var OSName=\"Unknown OS\";\r\n    if (navigator.appVersion.indexOf(\"Win\")!=-1) OSName=\"Windows\";\r\n    if (navigator.appVersion.indexOf(\"Mac\")!=-1) OSName=\"MacOS\";\r\n    if (navigator.appVersion.indexOf(\"X11\")!=-1) OSName=\"UNIX\";\r\n    if (navigator.appVersion.indexOf(\"Linux\")!=-1) OSName=\"Linux\";\r\n\r\n    var th = this;\r\n\t\tvar ws = new WebSocket('ws://localhost:11222/');\r\n\t\tvar finished = function () {\r\n      ws.close();\r\n      if(th.onReady) th.onReady();\r\n    };\r\n\r\n    var timeout = setTimeout(function () {\r\n\t\t\tconsole.warn(\"Calibration not found in internal memory.\");\r\n      th.initialized = true;\r\n      th.holoplay.initScreen(false);\r\n\t\t\t//finished();\r\n\t\t}, 1000);\r\n\r\n\t\tws.onmessage = function(event) {\r\n\t\t\tconsole.log(\"onMessage = \",event.data);\r\n      if(!th.initialized){\r\n\t\t\t   th.saveCalibration(event.data);\r\n\t\t\t   th.applyCalibration(event.data);\r\n\t\t\t   clearTimeout(timeout);\r\n         th.initialized = true;\r\n\r\n      }\r\n\t\t\tfinished();\r\n\t\t};\r\n\t\tws.onerror = function(event) {\r\n      var url:string = \"https://s3.amazonaws.com/static-files.lookingglassfactory.com/WebCalibrationBridge/LKG_ThreeJsDriver_Win.exe\";\r\n      if(OSName == \"MacOS\") url = \"https://s3.amazonaws.com/static-files.lookingglassfactory.com/WebCalibrationBridge/LKG_ThreeJsDriver_Mac.pkg\"\r\n      else if(OSName != \"Windows\") url = \"the driver doesn't exist on your OS :'(\"\r\n\r\n\t\t\tconsole.warn(\"Three.js driver not detected! download it here : \"+url);\r\n\r\n      clearTimeout(timeout);\r\n      th.initialized = true;\r\n      th.holoplay.initScreen(false);\r\n\t\t\tfinished();\r\n\t\t};\r\n  }\r\n\r\n  private applyCalibration (calibration_obj:any){\r\n    var jsonObj:any;\r\n    if(calibration_obj === undefined || calibration_obj === \"\"){\r\n        jsonObj = this.defaultCalibration;\r\n        alert(\"No Looking Glass display connected; using default calibration data. Please ensure your Looking Glass is connected to your computer via USB and reload the page.\")\r\n    } else {\r\n        jsonObj = JSON.parse(calibration_obj);\r\n    }\r\n\r\n    this.jsonObj = jsonObj;\r\n    this.holoplay.initScreen();\r\n\t\t//this.holoplay.screen.init(jsonObj.DPI.value, jsonObj.pitch.value, jsonObj.slope.value, jsonObj.center.value);\r\n\t}\r\n\r\n\tprivate saveCalibration (calibration_obj:any){\r\n\t\t//console.log(\"Calibration in local storage overwritten.\");\r\n\t\tlocalStorage['Config'] = calibration_obj;\r\n  }\r\n\r\n}\r\n"]}