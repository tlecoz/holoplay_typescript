{"version":3,"file":"Holoplay.js","sourceRoot":"","sources":["../Holoplay.ts"],"names":[],"mappings":"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","sourcesContent":["\r\n\r\nclass HoloPlay {\r\n\r\n  public scene:THREE.Scene;\r\n  public camera:THREE.PerspectiveCamera;\r\n  public renderer:THREE.WebGLRenderer;\r\n  public useClassicRendering:boolean = false;\r\n  public mode:string;\r\n  public width:number;\r\n  public height:number;\r\n\r\n  protected finalRenderScene:THREE.Scene;\r\n  protected finalRenderCamera:THREE.Camera;\r\n\r\n  public multiViewRenderer:HoloMultiViewRenderer;\r\n  public eppRom:HoloEppRom;\r\n  public screen:HoloScreen;\r\n\r\n  private useBorderInFullscreen:boolean = false;\r\n  private fullscreenBorderSize:number = 100;\r\n  private useEppRom:boolean = true;\r\n  private quiltPlane:THREE.Mesh;\r\n  private quiltPlayer:boolean = false;\r\n\r\n  constructor(scene:THREE.Scene,camera:THREE.PerspectiveCamera,renderer:THREE.WebGLRenderer, holoAppType:string = HoloAppType.HOLOGRAM){\r\n    this.scene = scene;\r\n    this.camera = camera;\r\n    this.renderer = renderer;\r\n\r\n    if(holoAppType == HoloAppType.CLASSIC_RENDERING){\r\n      holoAppType = HoloAppType.HOLOGRAM;\r\n      this.useClassicRendering = true;\r\n    }\r\n    if(holoAppType == HoloAppType.QUILT_PLAYER){\r\n      holoAppType = HoloAppType.HOLOGRAM;\r\n      this.quiltPlayer = true;\r\n\r\n    }\r\n\r\n    this.mode = holoAppType;\r\n\r\n  }\r\n\r\n\r\n  private quiltTexture:any = null;\r\n  private nbViewX:number;\r\n  private nbViewY:number;\r\n\r\n  public init(textureW:number=4096,textureH:number=4096,nbViewX:number=7,nbViewY:number=7,quiltVideo:HTMLVideoElement=null):void{\r\n\r\n    this.finalRenderScene = new THREE.Scene();\r\n    this.finalRenderCamera = new THREE.OrthographicCamera(-0.5,0.5,0.5,-0.5,0.001,300000);\r\n    this.finalRenderCamera.position.z = 2;\r\n\r\n    this.nbViewX = nbViewX;\r\n    this.nbViewY = nbViewY;\r\n\r\n\r\n\r\n    if(quiltVideo) this.quiltTexture = new THREE.VideoTexture(quiltVideo);\r\n    else this.multiViewRenderer = new HoloMultiViewRenderer(this,textureW/nbViewX,textureH/nbViewY,nbViewX,nbViewY);\r\n\r\n    this.screen = new HoloScreen(this);\r\n\r\n    this.quiltPlane = new THREE.Mesh(new THREE.PlaneGeometry(1,1),new THREE.MeshBasicMaterial({map:this.textureViews}))\r\n    this.quiltPlane.material.needsUpdate = true;\r\n\r\n    //console.log(this.multiViewRenderer.width,this.multiViewRenderer.height)\r\n\r\n    this.finalRenderScene.add(this.finalRenderCamera);\r\n    this.finalRenderScene.add(this.screen);\r\n    this.finalRenderScene.add(this.quiltPlane);\r\n\r\n    if(this.useEppRom) this.eppRom = new HoloEppRom(this);\r\n    else this.initScreen(false);\r\n\r\n  }\r\n\r\n  public get nbX():number{\r\n    return this.nbViewX;\r\n  }\r\n  public get nbY():number{\r\n    return this.nbViewY;\r\n  }\r\n  public get nbView():number{\r\n    return this.nbViewX * this.nbViewY;\r\n  }\r\n\r\n\r\n  public get textureViews():any{\r\n    //console.log(this.quiltPlayer)\r\n    if(this.quiltPlayer == false) return this.multiViewRenderer.texture;\r\n    else return this.quiltTexture;\r\n  }\r\n\r\n\r\n  public initScreen(useEppRom:boolean=true):void{\r\n    this.useEppRom = useEppRom;\r\n    this.screen.init(this.DPI, this.pitch, this.slope,  this.center);\r\n    this.onResize();\r\n\r\n  }\r\n\r\n  public get ready():boolean{return  (this.useEppRom == false) || this.eppRom.initialized}\r\n\r\n  public get DPI():number{\r\n    if(this.useEppRom) return this.eppRom.jsonObj.DPI.value;\r\n    else return 338;\r\n  }\r\n\r\n\r\n  public get slope():number{\r\n    if(this.useEppRom) return this.eppRom.jsonObj.slope.value;\r\n    else return -5.392934799194336\r\n  }\r\n  public get pitch():number{\r\n    if(this.useEppRom) return this.eppRom.jsonObj.pitch.value;\r\n    else return 47.58308029174805;\r\n\r\n  }\r\n\r\n\r\n  public get center():number{\r\n    if(this.useEppRom) return this.eppRom.jsonObj.center.value;\r\n    else return -0.028532594442367554;\r\n  }\r\n\r\n\r\n  public get depthRatio():number{return this.screen.depthRatio;}\r\n  public set depthRatio(n:number){ this.screen.depthRatio = n}\r\n\r\n\r\n\r\n  public onResize():void{\r\n\r\n    var w;\r\n    var h;\r\n    //console.log(\"onResize = \",this.mode)\r\n\r\n    this.quiltPlane.visible = this.mode == HoloAppType.QUILT_VIDEO_ENCODER;\r\n    this.screen.visible = (this.mode == HoloAppType.HOLOGRAM || this.mode == HoloAppType.HOLOGRAM_VIDEO_ENCODER);\r\n\r\n\r\n\r\n    if(this.mode == HoloAppType.HOLOGRAM){\r\n     w = window.innerWidth;\r\n     h = window.innerHeight;\r\n   }else if(this.mode == HoloAppType.HOLOGRAM_VIDEO_ENCODER || this.mode == HoloAppType.QUILT_VIDEO_ENCODER){\r\n      w = 2560;\r\n      h = 1600;\r\n    }\r\n\r\n    this.width = w;\r\n    this.height = h;\r\n\r\n    this.renderer.setSize(w,h);\r\n    this.camera.aspect = w/h;\r\n    this.camera.updateProjectionMatrix();\r\n    this.screen.updateViewConePitchAndTilt();\r\n  }\r\n\r\n  public useBlackBorderAroundFullscreen(borderSize:number=100){\r\n    this.useBorderInFullscreen = true;\r\n    this.fullscreenBorderSize = borderSize;\r\n  }\r\n\r\n  public update():void{\r\n\r\n    this.renderer.clear(true,true,true);\r\n\r\n    if(this.useClassicRendering){\r\n\r\n      this.renderer.render(this.scene,this.camera);\r\n\r\n    }else{\r\n\r\n      this.renderer.setSize(this.width,this.height);\r\n\r\n      if(!this.quiltPlayer) this.multiViewRenderer.captureViews();\r\n\r\n\r\n      if(this.mode == HoloAppType.HOLOGRAM || this.mode == HoloAppType.HOLOGRAM_VIDEO_ENCODER){\r\n        if(document[\"fullscreen\"] && this.useBorderInFullscreen && window.innerWidth == 2560 && window.innerHeight == 1600){\r\n          this.renderer.setScissorTest(true);\r\n          var size = this.fullscreenBorderSize;\r\n          this.renderer.setScissor(size,size,2560-size*2,1600-size*2)\r\n        }else{\r\n          this.renderer.setScissorTest(false);\r\n        }\r\n      }\r\n\r\n      if(this.mode == HoloAppType.QUILT_VIDEO_ENCODER) this.renderer.setSize(this.multiViewRenderer.width,this.multiViewRenderer.height);\r\n      this.renderer.render(this.finalRenderScene,this.finalRenderCamera);\r\n    }\r\n\r\n\r\n\r\n  }\r\n\r\n\r\n}\r\n"]}